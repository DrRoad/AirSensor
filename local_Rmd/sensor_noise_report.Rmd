---
title: "Sensor Noise Report"
author: "Mazama Science"
date: "6/17/2020"
output: html_document
params: 
  deviceDeploymentId: '332768ff95cbca00_2153'
  startdate: 20200601
  enddate: 20200607
---

```{r setup, include = FALSE}
library(AirSensor)
AirSensor::initializeMazamaSpatialUtils()
setArchiveBaseUrl("http://data.mazamascience.com/PurpleAir/v1") # SCAQMD sensors 
```

```{r load,include = FALSE, warning = FALSE}
pas <- pas_load()
pat <- pat_load(
  id = params$deviceDeploymentId,
  startdate = params$startdate, 
  enddate = params$enddate
)
```

### Sensor Multi-plot

```{r multiplot, warning = FALSE, fig.width = 14}
multi_plot <- pat_multiPlot(pat) 
multi_plot
```

### Sensor State of Health (Daily)

PurpleAir daily state-of-health (`pat_dailySoH()`) applies six algorithms:
- `PurpleAirSoH_dailyPctDC` 
- `PurpleAirSoH_dailyPctReporting`
- `PurpleAirSoH_dailyPctValid`
- `PurpleAirSoH_dailyOtherFit`
- `PurpleAirSoH_dailyABFit`
- `PurpleAirSoH_dailyABtTest`

```{r soh, warning = FALSE, fig.width = 14}
pat_soh <- pat_dailySoHPlot(pat)
pat_soh
```

See `?pat_dailySoH`, `?PurpleAirSoH_dailyPctDC`, `?PurpleAirSoH_dailyPctReporting`, `?PurpleAirSoH_dailyPctValid`, `?PurpleAirSoH_dailyPctValid`, `?PurpleAirSoH_dailyOtherFit`, `?PurpleAirSoH_dailyABFit`, and `?PurpleAirSoH_dailyABtTest` for more details. 

### PurpleAir Quality-Control 00

Creates a `pm25` timeseries by averaging aggregated data from the A and B channels and applying the following QC logic:

- Create pm25 by averaging the A and B channel aggregation means
- Invalidate data where:  (min_count < 20)

```{r qc_00, warning = FALSE, fig.width = 14}
qc_00 <- pat_monitorComparison(pat, FUN = AirSensor::PurpleAirQC_hourly_AB_00)
qc_00
```

See `?AirSensor::PurpleAirQC_hourly_AB_00` for more details regarding the quality-control algorithm.

### PurpleAir Quality-Control 01

Creates a `pm25` timeseries by averaging aggregated data from the A and B channels and applying the following QC logic:

- Create pm25 by averaging the A and B channel aggregation means
- Invalidate data where:  (min_count < 20)
- Invalidate data where:  (p-value < 1e-4) & (mean_diff > 10)
- Invalidate data where:  (pm25 < 100) & (mean_diff > 20)

```{r qc_01, warning = FALSE, fig.width = 14}
qc_01 <- pat_monitorComparison(pat, FUN = AirSensor::PurpleAirQC_hourly_AB_01)
qc_01
```

See `?AirSensor::PurpleAirQC_hourly_AB_01` for more details regarding the quality-control algorithm.

### PurpleAir Quality-Control 02

Creates a `pm25` timeseries by averaging aggregated data from the A and B channels and applying the following QC logic:

- Create pm25 by averaging the A and B channel aggregation means
- Invalidate data where:  (min_count < 20)
- Invalidate data where:  (A/B hourly median-absolute-deviation (MAD) > 3)
- Invalidate data where:  (A/B hourly percent difference (pct_diff) > 0.5)

```{r qc_02, warning = FALSE, fig.width = 14}
qc_02 <- pat_monitorComparison(pat, FUN = AirSensor::PurpleAirQC_hourly_AB_02)
qc_02
```

See `?AirSensor::PurpleAirQC_hourly_AB_02` for more details regarding the quality-control algorithm.

### PurpleAir Quality-Control 03

Creates a `pm25` timeseries by averaging aggregated data from the A and B channels and applying the following QC logic:

- Create pm25 by averaging the A and B channel aggregation means
- Invalidate data where:  (min_count < 20)
- Invalidate data where:  (A/B hourly difference > 5 AND A/B hourly percent difference > 70%)
- Invalidate data where:  (A/B hourly data recovery < 90%)


```{r qc_03, warning = FALSE, fig.width = 14}
qc_03 <- pat_monitorComparison(pat, FUN = AirSensor::PurpleAirQC_hourly_AB_03)
qc_03
```

See `?AirSensor::PurpleAirQC_hourly_AB_03` for more details regarding the quality-control algorithm.


_Mazama Science_