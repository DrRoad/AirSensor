---
title: "Working With Wind Data"
author: "Mazama Science"
date: "2019-07-24"
output: html_document
vignette: >
  %\VignetteIndexEntry{Working With Wind Data}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(AirSensor)
library(dplyr)
library(worldmet)
```

## worldmet package

Wind speed and direction readings are required to generate a Rose Plot or a 
Polar Plot. The package `worldmet` makes 35,000 NOAA stations availible which 
can provide this data with little effort.

First we must locate a NOAA site that is reasonably close to our sensor. This 
can be quickly done by hand by looking at a map of sites from the 
`worldmet::getMeta()` function with the general coordinates of the sensor.

In this example we'll be generating plots for Seal Beach. Let's set the 
appropriate longitude and latitude:

```{r show_site_map}
LA_meta <- worldmet::getMeta(lon = -118, lat = 34, n = 25)
```

Now we can zoom in to the communtity and find a nearby NOAA site. The "LOS 
ALAMITOS AAF AIRPORT" looks like a good choice. Clicking on its icon shows some
information including the site code. Let's copy that for the next segment.



```{r load_wind_data, echo=FALSE}
# Define the timeframe
start <- lubridate::ymd("2019-07-01")
end   <- lubridate::ymd("2019-07-10")

# Load wind data for the Los Alamitos Airport during the timeframe
windData <- worldmet::importNOAA(code = "722975-53141", year = 2019)
windData <- dplyr::select(windData, c("date", "wd", "ws"))
windData <- dplyr::filter(windData, date >= start, date < end)
```

Load a sensor object and plot the pollution rose with that and the wind data:

```{r}
sensor <- AirSensor::sensor_load(startdate = start, enddate = end)
AirSensor::sensor_pollutionRose(sensor, windData, statistic = "prop.mean")
```